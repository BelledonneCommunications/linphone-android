job-android:

  stage: build
  tags: [ "docker-android" ]
  image: gitlab.linphone.org:4567/bc/public/linphone-android/bc-dev-android:28

  script:
    - sdkmanager
    - echo $SCP_PRIVATE_KEY > id_rsa
    - chmod go-rwx id_rsa
    - echo $SCP_PRIVATE_KEY
    - cat ./id_rsa
    - scp -oStrictHostKeyChecking=no -i ./id_rsa $DEPLOY_SERVER:$ANDROID_KEYSTORE_PATH app/
    - echo $ANDROID_SIGNING_PROPERTIES > app/keystore.properies
    - ./gradlew app:assembleDebug
    - ./gradlew app:assembleRelease

  artifacts:
    paths:
      - ./app/build/outputs/apk/debug/linphone-android-debug-*.apk
    when: always
    expire_in: 1 week


.scheduled-job-android:
  extends: job-android
  only:
    - schedules